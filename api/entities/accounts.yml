# Account entity

# Types
_id:
  description: Account ID
  type: string

username:
  description: Account username
  type: string

password:
  type: string
  description: Account password

requestMfa:
  type: boolean
  description: Whether or not to request MFA (Note that the client must invoke `/accounts/verify-mfa` before MFA is enabled)

mfaEnabled:
  type: boolean
  description: Whether or not MFA is enabled (Note that if MFA has been requested but not verified, this will be `false`)

mfaSecret:
  type: string
  description: MFA secret (Only present if MFA was requested)

roles:
  description: Account roles
  type: array
  items:
    type: string

# Routes
all:
  get:
    operationId: getAllAccounts
    x-bifurcate-permissions: false
    x-operation-type: all
    tags:
      - 'accounts'
    summary: Get all accounts
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                required:
                  - 'id'
                  - 'username'
                  - 'mfaEnabled'
                  - 'roles'
                properties:
                  id:
                    $ref: '#/_id'
                  username:
                    $ref: '#/username'
                  mfaEnabled:
                    $ref: '#/mfaEnabled'
                  roles:
                    $ref: '#/roles'
      '400':
        $ref: '../responses.yml#/bad-request'
      '401':
        $ref: '../responses.yml#/unauthorized'
      '500':
        $ref: '../responses.yml#/internal-error'

create:
  post:
    operationId: createAccount
    x-bifurcate-permissions: false
    x-operation-type: create
    tags:
      - 'accounts'
    summary: Create an account
    description: The client must invoke `/accounts/mfa-confirm` with a valid TOTP otherwise MFA will be disabled to prevent accidental lockout.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - 'username'
              - 'password'
              - 'requestMfa'
              - 'roles'
            properties:
              username:
                $ref: '#/username'
              password:
                $ref: '#/password'
              requestMfa:
                $ref: '#/requestMfa'
              roles:
                $ref: '#/roles'
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              type: object
              required:
                - 'id'
              properties:
                id:
                  $ref: '#/_id'
                mfaSecret:
                  $ref: '#/mfaSecret'
      '400':
        $ref: '../responses.yml#/bad-request'
      '401':
        $ref: '../responses.yml#/unauthorized'
      '500':
        $ref: '../responses.yml#/internal-error'

impersonate:
  parameters:
    - name: id
      description: Account ID
      in: path
      required: true
      schema:
        type: string
  post:
    operationId: impersonateAccount
    x-bifurcate-permissions: false
    tags:
      - 'accounts'
    summary: Start/stop impersonating an account
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - 'enabled'
            properties:
              enabled:
                type: boolean
                description: Whether to start impersonating or stop impersonating
    responses:
      '200':
        $ref: '../responses.yml#/empty-success'
      '400':
        $ref: '../responses.yml#/bad-request'
      '401':
        $ref: '../responses.yml#/unauthorized'
      '500':
        $ref: '../responses.yml#/internal-error'

id:
  parameters:
    - name: id
      description: Account ID
      in: path
      required: true
      schema:
        type: string
  get:
    operationId: getAccount
    x-bifurcate-permissions: true
    x-operation-type: get
    tags:
      - 'accounts'
    summary: Get an account
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              type: object
              required:
                - 'username'
                - 'mfaEnabled'
                - 'roles'
              properties:
                username:
                  $ref: '#/username'
                mfaEnabled:
                  $ref: '#/mfaEnabled'
                roles:
                  $ref: '#/roles'
      '400':
        $ref: '../responses.yml#/bad-request'
      '401':
        $ref: '../responses.yml#/unauthorized'
      '500':
        $ref: '../responses.yml#/internal-error'

  patch:
    operationId: updateAccount
    x-bifurcate-permissions: true
    x-operation-type: update
    tags:
      - 'accounts'
    summary: Update an account
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              username:
                $ref: '#/username'
              password:
                $ref: '#/password'
              requestMfa:
                $ref: '#/requestMfa'
              roles:
                $ref: '#/roles'

    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                mfaSecret:
                  $ref: '#/mfaSecret'
      '400':
        $ref: '../responses.yml#/bad-request'
      '401':
        $ref: '../responses.yml#/unauthorized'
      '500':
        $ref: '../responses.yml#/internal-error'

  delete:
    operationId: deleteAccount
    x-bifurcate-permissions: true
    x-operation-type: delete
    tags:
      - 'accounts'
    summary: Delete an account
    responses:
      '200':
        $ref: '../responses.yml#/empty-success'
      '400':
        $ref: '../responses.yml#/bad-request'
      '401':
        $ref: '../responses.yml#/unauthorized'
      '500':
        $ref: '../responses.yml#/internal-error'
